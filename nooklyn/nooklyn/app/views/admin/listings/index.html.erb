<% content_for :title, "(#{@listings.total_count}) Nooklyn Listings Database" %>
<div class="nklyn-jumbotron">
  <div class="container">
    <h5><%= @listings.total_count %> listings</h5>
    <h1>Listing Database</h1>
  </div>
</div>
<div class="container-fluid">
  <%= render 'admin/shared/admin_navigation' %>
  <div class="container text-center">
    <%= render 'filters' %>
      <%= paginate @listings, :window => 10, :right => 1 %><br>
  </div>
  <div class="responsive-table">
    <table class="table nklyn-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Address</th>
          <th>Full Address</th>
          <th>Latitude</th>
          <th>Longitude</th>
          <th>Price</th>
          <th>& Per Bed</th>
          <th>Subway</th>
          <th>Bedrooms</th>
          <th>Bathrooms</th>
          <th>Available</th>
          <th>Listing</th>
          <th>Sales</th>
          <th>Created</th>
          <th>Updated</th>
          <th colspan="3">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @listings.each do |listing| %>
        <tr class="matrix-listing"
          data-is-residential="<%= listing.residential %>"
          data-status="<%= listing.status %>"
          data-bedrooms="<%= listing.bedrooms %>"
          data-bathrooms="<%= listing.bathrooms %>"
          data-price="<%= listing.price %>"
          data-id=<%= listing.id %>
          data-listing-agent="<%= listing.listing_agent.name %>"
          data-sales-agent="<%= listing.sales_agent.name %>"
          data-address="<%= listing.address %>"
          data-pets="<%= listing.pets %>"
          data-owner-pays="<%= listing.owner_pays %>"
          <% unless listing.date_available.blank? %>data-move="<%= listing.date_available.strftime('%D')%>"<% end %>
          data-amenities="<% listing.amenities.split("\n").each do |amenity| %> <%= amenity %> <% end %>">
          <td><%= listing.id %></td>
          <td><%= link_to listing.address, admin_listing_path(listing) %></td>
          <td><%= listing.full_address %></td>
          <td><%= listing.latitude %></td>
          <td><%= listing.longitude %></td>
          <td><%= number_to_currency(listing.price, precision: 0) %></td>
          <td><%= number_to_currency(listing.cost_per_bed, precision: 0) %></td>
          <td>
            <% listing.subway_line.strip.split(' ').each do |train| %>
              <%= image_tag "//nooklyn-files.s3.amazonaws.com/subway/#{train.upcase}.png" %>
            <% end %>
          </td>
          <td><%= number_to_human(listing.bedrooms) %></td>
          <td><%= number_to_human(listing.bathrooms) %></td>
          <td numerical-value="<%= listing.date_available %>">
            <% if listing.date_available? %>
            <%= listing.date_available.strftime('%D') %>
            <% end %>
          </td>
          <td>
            <%= link_to listing.listing_agent, target: "_blank" do %>
              <% if listing.listing_agent.profile_picture.nil? %>
                <%= image_tag 'missing.png', class: "img-circle" %>
              <% else %>
                <%= image_tag listing.listing_agent.profile_picture.url(:thumb), class: "img-circle img-responsive img-circle-small" %>
              <% end %>
            <% end %>
          </td>
          <td>
            <%= link_to listing.sales_agent, target: "_blank" do %>
              <% if listing.sales_agent.profile_picture.nil? %>
                <%= image_tag 'missing.png', class: "img-circle" %>
              <% else %>
                <%= image_tag listing.sales_agent.profile_picture.url(:thumb), class: "img-circle img-responsive img-circle-small" %>
              <% end %>
            <% end %>
          </td>
          <td numerical-value="<%= listing.created_at.to_i %>"><%= listing.created_at.strftime('%D at %I:%M%P') %></td>
          <td numerical-value="<%= listing.updated_at.to_i %>"><%= listing.updated_at.strftime('%D at %I:%M%P') %></td>
          <td><%= link_to 'Show', listing_path(listing), class: "button btn-default btn-2x" %></td>
          <td><%= link_to 'Edit', edit_listing_path(listing), class: "button btn-edit btn-2x", target: "_blank" %></td>
          <td><%= link_to 'Delete', listing, method: :delete, data: {confirm: 'Are you sure you want to delete the listing?' }, class: "button btn-red btn-2x" %></td>
        </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>
